<policies>
    <inbound>
        <!-- Check that the request is coming from our Front Door instance -->
        <check-header name="X-Azure-FDID" failed-check-httpcode="401" failed-check-error-message="Not authorized" ignore-case="true">
            <value>{{azure-frontdoor-id-header}}</value>
        </check-header>
        <!-- send all requests to our AKS backend -->
        <set-backend-service backend-id="aks-cluster" />
        <!-- Keep the original path, which contains the API suffix.
             Otherwise APIM will drop it but is is required on the ingress controller for routing -->
        <rewrite-uri template="@(context.Request.OriginalUrl.Path)" />
    </inbound>
    <backend>
        <forward-request />
    </backend>
    <outbound />
    <on-error />
</policies>