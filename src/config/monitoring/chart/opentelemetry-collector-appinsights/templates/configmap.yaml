apiVersion: v1
kind: ConfigMap
metadata:
  name: otel-collector-config
  labels:
    component: otel-collector-config
    app: {{ .Chart.Name }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    app.kubernetes.io/instance: {{ .Release.Name }}
    helm.sh/chart: {{ .Chart.Name }}-{{ .Chart.Version }}
data:
  otel-collector-config: |
    receivers:
      zipkin:
        endpoint: 0.0.0.0:9411
    extensions:
      health_check:
      pprof:
        endpoint: :1888
      zpages:
        endpoint: :55679
    exporters:
      logging:
        loglevel: debug
      azuremonitor:
        endpoint: {{ .Values.azuremonitor.endpoint | quote | default "https://dc.services.visualstudio.com/v2/track" }}
        instrumentation_key: {{ .Values.azuremonitor.instrumentationKey | quote | default "notset" }}
        # maxbatchsize is the maximum number of items that can be
        # queued before calling to the configured endpoint
        maxbatchsize: {{ .Values.azuremonitor.maxbatchsize | default 1024 }}
        # maxbatchinterval is the maximum time to wait before calling
        # the configured endpoint.
        maxbatchinterval: {{ .Values.azuremonitor.maxbatchinterval | quote | default "10s" }}
    service:
      extensions: [pprof, zpages, health_check]
      pipelines:
        traces:
          receivers: [zipkin]
          exporters: [azuremonitor,logging]